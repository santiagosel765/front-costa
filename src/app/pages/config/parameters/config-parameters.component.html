<nz-card nzTitle="Parámetros" [nzExtra]="createTpl">
  <app-data-table
    [columns]="columns"
    [data]="rows()"
    [loading]="loading()"
    [error]="error()"
    [total]="total()"
    [pageIndex]="state.page"
    [pageSize]="state.size"
    [searchValue]="state.q"
    searchPlaceholder="Buscar en parámetros"
    [emptyMessage]="'Aún no hay parámetros'"
    [emptyActionLabel]="'Crear primer parámetro'"
    (emptyAction)="createFirst()"
    (pageChange)="onPageChange($event)"
    (searchChange)="onSearchChange($event)"
    (action)="handleAction($event)"
  ></app-data-table>
</nz-card>

<ng-template #createTpl>
  <button nz-button nzType="primary" (click)="openCreate()">Nuevo parámetro</button>
</ng-template>

<nz-modal
  [nzVisible]="isModalVisible()"
  [nzTitle]="editingRow() ? 'Editar parámetro' : 'Nuevo parámetro'"
  [nzOkLoading]="saving()"
  [nzOkDisabled]="form.invalid || saving()"
  nzOkText="Guardar"
  nzCancelText="Cancelar"
  (nzOnCancel)="closeModal()"
  (nzOnOk)="save()"
>
  <ng-container *nzModalContent>
    <form nz-form [formGroup]="form" class="config-form">
      <nz-form-item>
        <nz-form-label [nzRequired]="true">Código</nz-form-label>
        <nz-form-control [nzErrorTip]="codeErrorTpl">
          <input nz-input formControlName="code" maxlength="50" style="text-transform: uppercase" (blur)="onCodeBlur()" />
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label [nzRequired]="true">Valor</nz-form-label>
        <nz-form-control [nzErrorTip]="valueErrorTpl">
          <textarea nz-input formControlName="value" rows="3" maxlength="255"></textarea>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label>Descripción</nz-form-label>
        <nz-form-control [nzErrorTip]="descriptionErrorTpl">
          <textarea nz-input formControlName="description" rows="3" maxlength="255"></textarea>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label>Activo</nz-form-label>
        <nz-form-control>
          <nz-switch formControlName="active"></nz-switch>
        </nz-form-control>
      </nz-form-item>
    </form>

    <ng-template #codeErrorTpl>
      <ng-container *ngIf="form.controls.code.hasError('required')">Código es requerido</ng-container>
      <ng-container *ngIf="form.controls.code.hasError('maxlength')">Máximo 50 caracteres</ng-container>
    </ng-template>

    <ng-template #valueErrorTpl>
      <ng-container *ngIf="form.controls.value.hasError('required')">Valor es requerido</ng-container>
      <ng-container *ngIf="form.controls.value.hasError('maxlength')">Máximo 255 caracteres</ng-container>
    </ng-template>

    <ng-template #descriptionErrorTpl>
      <ng-container *ngIf="form.controls.description.hasError('maxlength')">Máximo 255 caracteres</ng-container>
    </ng-template>
  </ng-container>
</nz-modal>
