<nz-card nzTitle="Tipos de documento" [nzExtra]="createTpl">
  <app-data-table
    [columns]="columns"
    [data]="rows()"
    [loading]="loading()"
    [error]="error()"
    [total]="total()"
    [pageIndex]="state.page"
    [pageSize]="state.size"
    [searchValue]="state.q"
    searchPlaceholder="Buscar en tipos de documento"
    [emptyMessage]="'Aún no hay tipos de documento'"
    [emptyActionLabel]="'Crear primer tipo de documento'"
    (emptyAction)="createFirst()"
    (pageChange)="onPageChange($event)"
    (searchChange)="onSearchChange($event)"
    (action)="handleAction($event)"
  ></app-data-table>
</nz-card>

<ng-template #createTpl>
  <button nz-button nzType="primary" (click)="openCreate()">Nuevo tipo</button>
</ng-template>

<nz-modal
  [nzVisible]="isModalVisible()"
  [nzTitle]="editingRow() ? 'Editar tipo de documento' : 'Nuevo tipo de documento'"
  [nzOkLoading]="saving()"
  [nzOkDisabled]="form.invalid || saving()"
  nzOkText="Guardar"
  nzCancelText="Cancelar"
  (nzOnCancel)="closeModal()"
  (nzOnOk)="save()"
>
  <ng-container *nzModalContent>
    <form nz-form [formGroup]="form" class="config-form">
      <nz-form-item>
        <nz-form-label [nzRequired]="true">Código</nz-form-label>
        <nz-form-control [nzErrorTip]="codeErrorTpl">
          <input nz-input formControlName="code" maxlength="20" style="text-transform: uppercase" (blur)="onCodeBlur()" />
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label [nzRequired]="true">Nombre</nz-form-label>
        <nz-form-control [nzErrorTip]="nameErrorTpl">
          <input nz-input formControlName="name" maxlength="100" />
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label>Descripción</nz-form-label>
        <nz-form-control [nzErrorTip]="descriptionErrorTpl">
          <textarea nz-input formControlName="description" rows="3" maxlength="255"></textarea>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label>Activo</nz-form-label>
        <nz-form-control>
          <nz-switch formControlName="active"></nz-switch>
        </nz-form-control>
      </nz-form-item>
    </form>

    <ng-template #codeErrorTpl>
      <ng-container *ngIf="form.controls.code.hasError('required')">Código es requerido</ng-container>
      <ng-container *ngIf="form.controls.code.hasError('maxlength')">Máximo 20 caracteres</ng-container>
    </ng-template>

    <ng-template #nameErrorTpl>
      <ng-container *ngIf="form.controls.name.hasError('required')">Nombre es requerido</ng-container>
      <ng-container *ngIf="form.controls.name.hasError('maxlength')">Máximo 100 caracteres</ng-container>
    </ng-template>

    <ng-template #descriptionErrorTpl>
      <ng-container *ngIf="form.controls.description.hasError('maxlength')">Máximo 255 caracteres</ng-container>
    </ng-template>
  </ng-container>
</nz-modal>
