<div class="auth-page-container">
  <app-page-header
    [breadcrumbs]="breadcrumbs"
    title="Usuarios"
    subtitle="Gestiona cuentas, estados y roles asignados de forma centralizada."
  >
    <span headerActions nz-tooltip [nzTooltipTitle]="!canWrite ? writeBlockedMessage : null">
      <button nz-button nzType="primary" (click)="goCreate()" [disabled]="!canWrite">
        <span nz-icon nzType="user-add"></span>
        Nuevo usuario
      </button>
    </span>
  </app-page-header>

  <nz-card nzBordered>
    <app-data-table
      [columns]="columns"
      [data]="tableRows()"
      [loading]="loading()"
      [error]="error()"
      [total]="total()"
      [pageIndex]="tableState.snapshot.page"
      [pageSize]="tableState.snapshot.size"
      [sortField]="tableState.snapshot.sortField"
      [sortOrder]="tableState.snapshot.sortOrder"
      [showStatusFilter]="true"
      [statusOptions]="statusOptions"
      [statusValue]="tableState.snapshot.status"
      [searchValue]="tableState.snapshot.q"
      searchPlaceholder="Buscar por usuario, email o nombre"
      emptyMessage="No hay usuarios registrados todavÃ­a."
      (pageChange)="onPageChange($event)"
      (sortChange)="onSortChange($event)"
      (searchChange)="onSearchChange($event)"
      (filterChange)="onFilterChange($event)"
      (action)="handleAction($event)"
    ></app-data-table>

    <ng-template #rolesTemplate let-user>
      <ng-container *ngIf="user.roleNames?.length || user.roles?.length; else noRoles">
        <nz-tag nzColor="blue" *ngFor="let role of (user.roleNames?.length ? user.roleNames : user.roles)">{{ role }}</nz-tag>
      </ng-container>
      <ng-template #noRoles>
        <nz-tag nzColor="default">{{ rolesLabel(user) }}</nz-tag>
      </ng-template>
    </ng-template>
  </nz-card>
</div>
