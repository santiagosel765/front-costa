<nz-card nzBordered>
  <div class="numbering-header">
    <div>
      <h3>Numeración</h3>
      <p>Configura series y correlativos por sucursal y tipo de documento.</p>
    </div>
    <button *ngIf="canWrite()" nz-button nzType="primary" (click)="openCreate()">Nueva numeración</button>
  </div>

  <app-data-table
    [columns]="columns"
    [data]="rows()"
    [loading]="loading()"
    [error]="error()"
    [total]="total()"
    [pageIndex]="tableState.snapshot.page"
    [pageSize]="tableState.snapshot.size"
    [searchValue]="tableState.snapshot.q"
    [showStatusFilter]="true"
    [statusValue]="tableState.snapshot.status"
    [statusOptions]="[{ label: 'Todos', value: null }, { label: 'Activos', value: 'true' }, { label: 'Inactivos', value: 'false' }]"
    searchPlaceholder="Buscar numeración"
    (pageChange)="onPageChange($event)"
    (searchChange)="onSearchChange($event)"
    (filterChange)="onFilterChange($event)"
    (action)="handleAction($event)"
  ></app-data-table>
</nz-card>

<nz-modal
  [nzVisible]="isModalVisible()"
  [nzTitle]="editingId() ? 'Editar numeración' : 'Nueva numeración'"
  [nzOkLoading]="saving()"
  [nzOkDisabled]="form.invalid"
  (nzOnCancel)="closeModal()"
  (nzOnOk)="save()"
>
  <ng-container *nzModalContent>
    <form [formGroup]="form" class="numbering-form">
      <label>Sucursal *</label>
      <nz-select nzShowSearch nzPlaceHolder="Seleccionar sucursal" formControlName="branchId">
        <nz-option *ngFor="let option of branchOptions" [nzLabel]="option.label" [nzValue]="option.value"></nz-option>
      </nz-select>

      <label>Tipo documento *</label>
      <nz-select nzShowSearch nzPlaceHolder="Seleccionar tipo documento" formControlName="documentTypeId">
        <nz-option *ngFor="let option of documentTypeOptions" [nzLabel]="option.label" [nzValue]="option.value"></nz-option>
      </nz-select>

      <label>Serie *</label>
      <input nz-input formControlName="series" />

      <div class="numeric-grid">
        <div>
          <label>Próximo número *</label>
          <nz-input-number class="full-width" formControlName="nextNumber" [nzMin]="1"></nz-input-number>
        </div>
        <div>
          <label>Padding *</label>
          <nz-input-number class="full-width" formControlName="padding" [nzMin]="1"></nz-input-number>
        </div>
      </div>

      <div class="preview-box">
        <strong>Preview:</strong> {{ preview }}
      </div>

      <div class="switch-row">
        <label>Activo</label>
        <nz-switch formControlName="active"></nz-switch>
      </div>
    </form>
  </ng-container>
</nz-modal>
